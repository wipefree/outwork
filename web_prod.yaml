---
- name: deploy project with tomcat in container
  hosts: web_servers[1]
  become: yes

  tasks:
    - name: update apt cache
      apt:
        update_cache: yes

    - name: install needed software
      apt:
        name:
          - docker.io
        state: present

    - name: send key for docker ( 1. for reg to registry, 2. for build image )
      copy:
        src: /tmp/ansible_key.json
        dest: /tmp/
        mode: '0644'

    - name: docker registration, build new image, push to registry
      shell: |
        sudo yc config set service-account-key /tmp/ansible_key.json
        sudo yc container registry configure-docker
        sudo docker run -d -p 8080:8080 cr.yandex/crpirf1t243rd4chrqfd/prod:latest
...